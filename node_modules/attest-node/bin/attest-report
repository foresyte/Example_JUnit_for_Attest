#! /usr/bin/env node

var attestReport = require('../reporter/attest-report');
var fs = require('fs');
var path = require('path');

/**
 * Parse arguments.
 */
var program = require('commander');
var VERSION = require('../package.json').version;

program
.version(VERSION)
.usage('<path/to/json/dir> [options] ')
.option('-b --browser [name]', 'specify which browser\'s results should be used to generate the output')
.option('-d --dest [path]', 'specify the desired output path')
.option('-f --format [type(s)]', 'Format(s) for output: html (default), junit (xml)')
.parse(process.argv);

var dir = ('' + program.args[0]);
if (!fs.existsSync(dir)) {
	console.log('"', program.args[0], '" is not an existing directory');
	return;
}

var reporter = attestReport.init('attest-a11yCheck', dir);
var output = program.dest || path.join(process.cwd(), 'attest-reports');

(program.format || 'default')
.split(/[,;+\s]/)
.forEach(function (format) {
	format = format.toLowerCase().trim();

	if (['html', 'default'].indexOf(format) !== -1) {
		reporter.buildHTML(output, program.browser);
		console.log('Attest HTML report created at ', output);

	// } else if (['xls', 'xlsx'].indexOf(format) !== -1) {
	// 	reporter.buildXLS(output, program.browser);
	// 	console.log('Attest XLSX report created at ', output);

	} else if (['junit', 'xml', 'junitxml'].indexOf(format) !== -1) {
		reporter.buildJUnitXML(output, program.browser);
		console.log('Attest JUnit XML report created at ', output);
	}
});